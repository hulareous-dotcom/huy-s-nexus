<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Huy's Nexus | Stable Core</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Space+Grotesk:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Word Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>

    <style>
        /* --- 1. CORE VARIABLES --- */
        :root {
            --bg-dark: #0a0b1e;
            --text-light: #ffffff;
            --accent-primary: #4cc9f0;
            --accent-secondary: #f72585;
            --doc-bg: #fdfbf7;
            --doc-text: #2c2c2c;
            --doc-accent: #c0a080;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Manrope', sans-serif; 
            background-color: var(--bg-dark); 
            color: var(--text-light); 
            overflow: hidden; 
            height: 100vh;
        }

        /* --- 2. HEADER & TABS --- */
        .edge-chrome {
            height: 50px; background: #1e1e2e; display: flex; align-items: center;
            padding: 0 10px; border-bottom: 1px solid #333; position: fixed; top: 0; width: 100%; z-index: 1000; user-select: none;
        }
        .tab-list { display: flex; gap: 6px; flex: 1; overflow-x: auto; align-items: center; height: 100%; padding-top: 6px; scroll-behavior: smooth; }
        .tab-list::-webkit-scrollbar { height: 0; }
        .tab {
            background: #2a2a3a; color: #ccc; padding: 0 12px; height: 38px; border-radius: 8px 8px 0 0; font-size: 13px;
            display: flex; align-items: center; gap: 8px; cursor: pointer; transition: background 0.2s;
            max-width: 200px; min-width: 120px; border-right: 1px solid #333; position: relative; opacity: 1; 
        }
        .tab.invisible-waiting { opacity: 0; }
        .tab span { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; flex: 1; }
        .tab:hover { background: #3a3a4a; }
        .tab.active { background: var(--doc-bg); color: #000; font-weight: 600; }
        .tab[data-target="home-view"].active { background: #3a3a4a; color: #fff; }
        .tab-close { width: 16px; height: 16px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; opacity: 0.6; }
        .tab-close:hover { background: #ff5f57; color: white; opacity: 1; }
        .add-btn { width: 30px; height: 30px; margin-left: 10px; border-radius: 4px; color: #aaa; display: flex; align-items: center; justify-content: center; font-size: 20px; cursor: pointer; flex-shrink: 0; }
        .add-btn:hover { background: rgba(255,255,255,0.1); color: white; }

        /* --- 3. SMART FLOATING BAR --- */
        .floating-bar {
            position: fixed; top: 65px; left: 20px; z-index: 9998;
            background: rgba(15, 15, 25, 0.85); backdrop-filter: blur(15px); padding: 4px 6px; border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15); display: flex; align-items: center; gap: 4px;
            opacity: 0.6; transition: all 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .floating-bar:hover { opacity: 1; transform: translateY(2px); background: rgba(15, 15, 25, 0.95); }
        .f-item { min-width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 600; font-family: 'Space Grotesk', sans-serif; cursor: pointer; color: #888; transition: 0.2s; flex-shrink: 0; }
        .f-item:hover { color: white; background: rgba(255,255,255,0.1); }
        .f-item.current { background: var(--text-light); color: #000; font-weight: 800; box-shadow: 0 0 8px rgba(255, 255, 255, 0.3); }
        .f-dots { color: #555; font-size: 0.8rem; padding: 0 2px; cursor: default; }
        .f-action { font-size: 0.7rem; width: 28px; height: 28px; border-radius: 50%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #aaa; font-weight: 700; }
        .f-action.a-btn:hover { background: var(--accent-primary); color: #000; border-color: transparent; }
        .f-action.da-btn:hover { background: var(--accent-secondary); color: #fff; border-color: transparent; }

        /* --- 4. VIEWPORT --- */
        .viewport { margin-top: 50px; height: calc(100vh - 50px); position: relative; background: #000; }
        .view-panel { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; overflow-y: auto; background: var(--doc-bg); color: var(--doc-text); }
        .view-panel.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

        /* --- 5. DASHBOARD --- */
        #home-view {
            background: linear-gradient(rgba(10,11,30,0.92), rgba(10,11,30,0.96)), url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072&auto=format&fit=crop') no-repeat center center fixed;
            background-size: cover; color: white; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center; padding-bottom: 5vh; 
        }
        .home-content { width: 100%; display: flex; flex-direction: column; align-items: center; position: relative; }
        
        .logo {
            font-family: 'Space Grotesk', sans-serif; font-size: 5.5rem; font-weight: 700;
            background: linear-gradient(to right, #fff, #4cc9f0); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 50px; letter-spacing: -3px; text-align: center; text-transform: lowercase;
            filter: drop-shadow(0 0 20px rgba(76, 201, 240, 0.2));
        }

        .search-area { position: relative; width: 50%; margin-bottom: 70px; display: flex; flex-direction: column; align-items: center; }

        .search-box {
            width: 100%; padding: 20px 30px;
            background: rgba(255,255,255,0.03); backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 2px;
            color: white; font-size: 1.2rem; outline: none; transition: 0.3s; text-align: center;
            font-family: 'Space Grotesk', sans-serif; letter-spacing: 2px; text-transform: uppercase;
        }
        .search-box:focus { background: rgba(255,255,255,0.08); border-color: var(--accent-primary); box-shadow: 0 0 30px rgba(76, 201, 240, 0.1); }
        .search-box::placeholder { color: rgba(255,255,255,0.3); letter-spacing: 1px;}

        /* SEARCH CANVAS */
        #searchCanvas {
            position: absolute; top: 100%; left: 0; width: 100%;
            max-height: 0; opacity: 0;
            background: rgba(10, 11, 30, 0.95); backdrop-filter: blur(30px);
            border: 1px solid rgba(255,255,255,0.1); border-top: none;
            overflow-y: auto; transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 999; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        #searchCanvas.active { max-height: 400px; opacity: 1; margin-top: 10px; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; }
        #searchCanvas::-webkit-scrollbar { width: 6px; }
        #searchCanvas::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }

        .search-result-item { padding: 20px 30px; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; transition: 0.2s; text-align: left; }
        .search-result-item:hover { background: rgba(255,255,255,0.05); border-left: 3px solid var(--accent-primary); }
        .res-location { font-family: 'Space Grotesk', sans-serif; font-size: 0.8rem; color: var(--accent-primary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .res-snippet { font-size: 0.95rem; color: #ccc; line-height: 1.5; font-family: 'Manrope', sans-serif; }
        .highlight { background: rgba(247, 37, 133, 0.3); color: #fff; padding: 0 2px; border-radius: 2px; font-weight: bold; }
        .no-result { padding: 30px; color: #666; font-style: italic; }

        /* GRID */
        .tile-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 25px; padding: 0; width: 100%; max-width: 1000px; }
        .tile {
            aspect-ratio: 1.8; background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255,255,255,0.08); border-radius: 4px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.5s; padding: 10px; text-align: center; position: relative; overflow: hidden;
        }
        .tile::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(120deg, transparent, rgba(255,255,255,0.05), transparent); transform: translateX(-100%); transition: 0.6s; }
        .tile:hover { background: rgba(255, 255, 255, 0.06); transform: translateY(-5px); border-color: rgba(255,255,255,0.4); box-shadow: 0 15px 40px rgba(0,0,0,0.4); }
        .tile:hover::before { transform: translateX(100%); }
        .tile-title { font-family: 'Space Grotesk', sans-serif; font-size: 0.95rem; font-weight: 600; color: #777; text-transform: uppercase; letter-spacing: 1.5px; transition: 0.4s; }
        .tile:hover .tile-title { color: #fff; letter-spacing: 3px; text-shadow: 0 0 15px rgba(255,255,255,0.6); }

        .morph-ghost {
            position: fixed; z-index: 9999;
            background: rgba(255, 255, 255, 0.1); border: 1px solid var(--accent-primary);
            border-radius: 4px; pointer-events: none; transform-origin: center;
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex; align-items: center; justify-content: center; overflow: hidden;
        }

        /* --- 6. DOCUMENT CONTENT --- */
        .doc-layout { max-width: 900px; margin: 0 auto; padding: 60px 40px; background: #fff; min-height: 100%; }
        .doc-header { text-align: center; border-bottom: 2px solid var(--doc-accent); padding-bottom: 30px; margin-bottom: 40px; }
        .doc-title { font-family: 'Playfair Display', serif; font-size: 2.8rem; color: #111; margin-bottom: 10px; line-height: 1.2; }
        .doc-meta { font-family: 'Space Grotesk', sans-serif; color: #888; letter-spacing: 2px; text-transform: uppercase; font-size: 0.8rem; }
        
        /* IMAGE STYLES - STABLE LOADING */
        .doc-image { 
            width: 100%; height: 350px; object-fit: cover; border-radius: 4px; margin-bottom: 40px; filter: sepia(0.1); 
            background: #eee; /* Placeholder color while loading */
        }
        
        .doc-content { font-size: 1.15rem; line-height: 1.8; color: #333; text-align: justify; }
        .doc-content h2 { font-family: 'Playfair Display', serif; margin-top: 35px; margin-bottom: 15px; color: #000; font-size: 1.8rem; border-left: 4px solid var(--accent-primary); padding-left: 15px; }
        .doc-content h3 { font-family: 'Manrope', sans-serif; font-weight: 600; font-size: 1.3rem; margin-top: 25px; color: #444; }
        .doc-content ul { list-style-type: none; padding-left: 0; margin-bottom: 25px; }
        .doc-content ul li { padding-left: 20px; position: relative; margin-bottom: 12px; }
        .doc-content ul li::before { content: "‚Ä¢"; color: var(--accent-secondary); font-weight: bold; position: absolute; left: 0; }
        .doc-highlight { background: #fdf6e3; padding: 25px; border-left: 5px solid #d33682; margin: 30px 0; font-style: italic; color: #555; }

        /* --- 7. CHATBOX UI --- */
        .chat-widget { position: fixed; bottom: 30px; right: 30px; z-index: 9999; }
        .chat-btn { width: 70px; height: 70px; border-radius: 50%; background: white; border: 3px solid #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.2); cursor: pointer; transition: transform 0.3s; }
        .chat-btn:hover { transform: scale(1.1); }
        .chat-btn img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; }
        
        .chat-window { 
            position: absolute; bottom: 90px; right: 0; width: 380px; height: 600px; 
            background: #fff; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); 
            display: flex; flex-direction: column; transform: scale(0); transform-origin: bottom right; 
            transition: 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28); opacity: 0; pointer-events: none; 
        }
        .chat-window.open { transform: scale(1); opacity: 1; pointer-events: all; }
        
        .chat-header { background: linear-gradient(135deg, #4f46e5, #06b6d4); color: white; padding: 20px; display: flex; align-items: center; gap: 15px; }
        .chat-body { flex: 1; padding: 20px; background: #f9fafb; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
        
        .msg { max-width: 80%; padding: 12px 16px; border-radius: 16px; font-size: 0.95rem; line-height: 1.5; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
        
        .msg.bot { background: white; align-self: flex-start; border-bottom-left-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); color: #333; }
        .msg.bot a { color: #2563eb; font-weight: 700; text-decoration: none; border-bottom: 2px solid rgba(37, 99, 235, 0.2); transition: 0.2s; }
        .msg.bot a:hover { color: #f72585; border-color: #f72585; }

        .msg.user { background: #4f46e5; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        
        .chat-footer { padding: 15px; background: white; border-top: 1px solid #eee; display: flex; gap: 10px; }
        .chat-input { flex: 1; padding: 10px 15px; border-radius: 20px; border: 1px solid #ddd; outline: none; }
        .chat-input:focus { border-color: #4f46e5; }

        .typing-indicator { display: none; gap: 4px; padding: 12px 16px; background: white; width: fit-content; border-radius: 16px; align-self: flex-start; border-bottom-left-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .dot { width: 6px; height: 6px; background: #bbb; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        .suggestions { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
        .chip { background: #e0e7ff; color: #4338ca; padding: 6px 12px; border-radius: 15px; font-size: 0.85rem; cursor: pointer; transition: 0.2s; border: 1px solid transparent; }
        .chip:hover { background: #c7d2fe; border-color: #4338ca; }

        #fileInput { display: none; }
    </style>
</head>
<body>

    <div class="edge-chrome">
        <div class="tab-list" id="tabList">
            <div class="tab active" data-target="home-view" onclick="switchTab('home-view')">
                <span>üè† Home</span>
            </div>
        </div>
        <div class="add-btn" onclick="triggerImport()">+</div>
    </div>

    <div class="floating-bar" id="floatingBar"></div>

    <input type="file" id="fileInput" accept=".html,.txt,.docx" onchange="processFile(this)">

    <div class="viewport" id="viewport">
        <div id="home-view" class="view-panel active">
            <div class="home-content">
                <div class="logo">huy's nexus</div>
                
                <div class="search-area">
                    <input type="text" class="search-box" id="searchBox" placeholder="ENTER KEYWORD TO ACCESS..." onkeyup="handleSearchInput(event)">
                    <div id="searchCanvas"></div>
                </div>

                <div class="tile-grid" id="tileGrid"></div>
            </div>
        </div>
    </div>

    <div class="chat-widget">
        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                <img src="https://cdn-icons-png.flaticon.com/512/4712/4712035.png" style="width:40px;border-radius:50%">
                <div><h4 style="margin:0">Huy's Assistant</h4><small>S·∫µn s√†ng h·ªó tr·ª£</small></div>
            </div>
            <div class="chat-body" id="chatBody">
                <div class="typing-indicator" id="typingIndicator">
                    <div class="dot"></div><div class="dot"></div><div class="dot"></div>
                </div>
            </div>
            <div class="chat-footer">
                <input type="text" class="chat-input" id="chatInput" placeholder="Nh·∫≠p c√¢u h·ªèi..." onkeypress="if(event.key==='Enter') sendMsg()">
                <div onclick="sendMsg()" style="cursor:pointer;color:blue;font-size:1.2rem;">‚û§</div>
            </div>
        </div>
        <div class="chat-btn" onclick="toggleChat()">
            <img src="https://cdn-icons-png.flaticon.com/512/4712/4712035.png">
        </div>
    </div>

    <script>
        /* --- D·ªÆ LI·ªÜU H√åNH ·∫¢NH ·ªîN ƒê·ªäNH --- */
        const topics = [
            { id: 1, title: "Chatbot & GenAI", img: "https://images.unsplash.com/photo-1531746790731-6c087fecd65a?auto=format&fit=crop&w=1000&q=80", content: `<h2>1. C√°ch m·∫°ng h√≥a d·ªãch v·ª• kh√°ch h√†ng</h2><p>Chatbot AI th·∫ø h·ªá m·ªõi...</p>` },
            { id: 2, title: "Fraud Detection", img: "https://images.unsplash.com/photo-1550751827-4bd374c3f58b?auto=format&fit=crop&w=1000&q=80", content: `<h2>1. Cu·ªôc chi·∫øn ch·ªëng gian l·∫≠n</h2><p>AI ph√°t hi·ªán b·∫•t th∆∞·ªùng...</p>` },
            { id: 3, title: "Personal Finance", img: "https://images.unsplash.com/photo-1579621970563-ebec7560eb3e?auto=format&fit=crop&w=1000&q=80", content: `<h2>1. Qu·∫£n l√Ω t√†i ch√≠nh c√° nh√¢n</h2><p>PFM t·ª± ƒë·ªông ph√¢n lo·∫°i...</p>` },
            { id: 4, title: "Voice Banking", img: "https://images.unsplash.com/photo-1590602847861-f357a9332bbc?auto=format&fit=crop&w=1000&q=80", content: `<h2>1. Giao d·ªãch kh√¥ng ch·∫°m</h2><p>Sinh tr·∫Øc h·ªçc gi·ªçng n√≥i...</p>` },
            { id: 5, title: "AI Credit Scoring", img: "https://images.unsplash.com/photo-1554224155-8d04cb21cd6c?auto=format&fit=crop&w=1000&q=80", content: `<h2>1. Ch·∫•m ƒëi·ªÉm t√≠n d·ª•ng</h2><p>D·ªØ li·ªáu thay th·∫ø...</p>` },
            { id: 6, title: "eKYC & Identity", img: "https://images.unsplash.com/photo-1555421689-d68471e189f2?auto=format&fit=crop&w=1000&q=80", content: `<h2>1. ƒê·ªãnh danh ƒëi·ªán t·ª≠</h2><p>Liveness Detection...</p>` },
            { id: 7, title: "Cashflow Forecast", img: "https://images.unsplash.com/photo-1543286386-713df548e9cc?auto=format&fit=crop&w=1000&q=80", content: `<h2>1. D·ª± b√°o d√≤ng ti·ªÅn</h2><p>C·∫£nh b√°o thanh kho·∫£n...</p>` },
            { id: 8, title: "Robo-Advisors", img: "https://images.unsplash.com/photo-1611974765270-ca12586343bb?auto=format&fit=crop&w=1000&q=80", content: `<h2>1. C·ªë v·∫•n ƒë·∫ßu t∆∞</h2><p>T√°i c√¢n b·∫±ng t·ª± ƒë·ªông...</p>` },
            { id: 9, title: "Sentiment Analysis", img: "https://images.unsplash.com/photo-1516321318423-f06f85e504b3?auto=format&fit=crop&w=1000&q=80", content: `<h2>1. L·∫Øng nghe x√£ h·ªôi</h2><p>Ph√¢n t√≠ch c·∫£m x√∫c...</p>` },
            { id: 10, title: "RPA & Automation", img: "https://images.unsplash.com/photo-1485827404703-89b55fcc595e?auto=format&fit=crop&w=1000&q=80", content: `<h2>1. Si√™u t·ª± ƒë·ªông h√≥a</h2><p>Robot Back-office...</p>` }
        ];

        let importedFilesData = []; 

        const botBrain = {
            "xin ch√†o": "Ch√†o b·∫°n! Ch√†o m·ª´ng ƒë·∫øn v·ªõi Huy's Nexus. T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n h√¥m nay?",
            "hi": "Hi! R·∫•t vui ƒë∆∞·ª£c g·∫∑p b·∫°n t·∫°i Huy's Nexus. C·∫ßn m√¨nh h·ªó tr·ª£ g√¨ kh√¥ng?",
            "huy": "Huy l√† nh√† ph√°t tri·ªÉn ch√≠nh, ki·∫øn tr√∫c s∆∞ c·ªßa h·ªá th·ªëng Nexus.",
            "nexus": "Huy's Nexus l√† m·ªôt h·ªá sinh th√°i s·ªë t√≠ch h·ª£p c√¥ng ngh·ªá AI ti√™n ti·∫øn ƒë·ªÉ h·ªó tr·ª£ ng∆∞·ªùi d√πng.",
            "l√£i su·∫•t": "L√£i su·∫•t ti·∫øt ki·ªám hi·ªán t·∫°i ƒëang ·ªü m·ª©c h·∫•p d·∫´n: 6.8%/nƒÉm cho k·ª≥ h·∫°n 12 th√°ng. B·∫°n c√≥ mu·ªën xem b·∫£ng l√£i su·∫•t chi ti·∫øt kh√¥ng?",
            "th·∫ª t√≠n d·ª•ng": "Ch√∫ng t√¥i c√≥ c√°c d√≤ng th·∫ª: Classic, Gold v√† Platinum. Ho√†n ti·ªÅn t·ªõi 10% cho m·ªçi chi ti√™u.",
            "vay": "Ch√∫ng t√¥i cung c·∫•p g√≥i vay ti√™u d√πng l√£i su·∫•t t·ª´ 0.8%/th√°ng v√† vay mua nh√† t·ª´ 7.5%/nƒÉm.",
            "ekyc": "Quy tr√¨nh eKYC gi√∫p b·∫°n m·ªü t√†i kho·∫£n 100% online ch·ªâ trong 2 ph√∫t b·∫±ng CMND/CCCD v√† x√°c th·ª±c khu√¥n m·∫∑t.",
            "b·∫£o m·∫≠t": "H·ªá th·ªëng Nexus s·ª≠ d·ª•ng m√£ h√≥a 256-bit v√† x√°c th·ª±c sinh tr·∫Øc h·ªçc ƒë·ªÉ ƒë·∫£m b·∫£o an to√†n tuy·ªát ƒë·ªëi.",
            "s·ªë d∆∞": "ƒê·ªÉ tra c·ª©u s·ªë d∆∞, vui l√≤ng ƒëƒÉng nh·∫≠p v√†o ·ª©ng d·ª•ng Banking v√† ch·ªçn m·ª•c 'T√†i kho·∫£n'.",
            "chuy·ªÉn ti·ªÅn": "D·ªãch v·ª• chuy·ªÉn ti·ªÅn nhanh 24/7 mi·ªÖn ph√≠ tr·ªçn ƒë·ªùi cho m·ªçi giao d·ªãch trong v√† ngo√†i h·ªá th·ªëng.",
            "ph√≠": "Huy's Nexus cam k·∫øt 'Zero Fee': Mi·ªÖn ph√≠ chuy·ªÉn kho·∫£n, mi·ªÖn ph√≠ duy tr√¨ t√†i kho·∫£n.",
            "qu√™n m·∫≠t kh·∫©u": "ƒê·ª´ng lo, b·∫°n c√≥ th·ªÉ ch·ªçn 'Qu√™n m·∫≠t kh·∫©u' ·ªü m√†n h√¨nh ƒëƒÉng nh·∫≠p v√† x√°c th·ª±c qua SMS OTP ƒë·ªÉ c·∫•p l·∫°i.",
            "t·ª∑ gi√°": "T·ª∑ gi√° h√¥m nay: USD/VND = 24,550. EUR/VND = 26,200. B·∫°n c·∫ßn ƒë·ªïi ngo·∫°i t·ªá n√†o?",
            "ti·∫øt ki·ªám": "G·ª≠i ti·∫øt ki·ªám online ƒë∆∞·ª£c c·ªông th√™m 0.2% l√£i su·∫•t so v·ªõi t·∫°i qu·∫ßy. K·ª≥ h·∫°n linh ho·∫°t t·ª´ 1 tu·∫ßn ƒë·∫øn 36 th√°ng.",
            "gian l·∫≠n": "N·∫øu nghi ng·ªù gian l·∫≠n, h√£y kh√≥a th·∫ª ngay tr√™n App v√† g·ªçi Hotline kh·∫©n c·∫•p 1900-6767-6969.",
            "ƒë·∫ßu t∆∞": "Robo-Advisor c·ªßa ch√∫ng t√¥i c√≥ th·ªÉ gi√∫p b·∫°n ƒë·∫ßu t∆∞ v√†o qu·ªπ m·ªü v√† tr√°i phi·∫øu ch·ªâ t·ª´ 50.000ƒë.",
            "li√™n h·ªá": "Th√¥ng tin li√™n h·ªá:<br>‚Ä¢ Hotline: 1900-6767-6969<br>‚Ä¢ Email: hulareous@gmail.com<br>‚Ä¢ Facebook: <a href='https://www.facebook.com/hulareous' target='_blank'>Huy's Facebook</a>",
            "hotline": "Hotline 24/7 c·ªßa ch√∫ng t√¥i l√†: 1900-6767-6969.",
            "sƒët": "S·ªë ƒëi·ªán tho·∫°i t·ªïng ƒë√†i: 1900-6767-6969.",
            "g·ªçi": "B·∫°n c√≥ th·ªÉ g·ªçi ngay cho ch√∫ng t√¥i qua s·ªë 1900-6767-6969.",
            "email": "B·∫°n c√≥ th·ªÉ g·ª≠i y√™u c·∫ßu v·ªÅ ƒë·ªãa ch·ªâ email: hulareous@gmail.com.",
            "gmail": "Email h·ªó tr·ª£: hulareous@gmail.com.",
            "mail": "Vui l√≤ng g·ª≠i mail v·ªÅ hulareous@gmail.com.",
            "ƒë·ªãa ch·ªâ": "VƒÉn ph√≤ng ch√≠nh t·∫°i TP.HCM. ƒê·ªÉ bi·∫øt v·ªã tr√≠ ch√≠nh x√°c, vui l√≤ng li√™n h·ªá qua: <a href='https://www.facebook.com/hulareous' target='_blank'>Huy's Facebook</a>",
            "facebook": "K·∫øt n·ªëi v·ªõi Huy qua: <a href='https://www.facebook.com/hulareous' target='_blank'>Huy's Facebook</a>",
            "fb": "Facebook ch√≠nh ch·ªß: <a href='https://www.facebook.com/hulareous' target='_blank'>Huy's Facebook</a>",
            "mxh": "M·∫°ng x√£ h·ªôi ch√≠nh th·ª©c: <a href='https://www.facebook.com/hulareous' target='_blank'>Huy's Facebook</a>",
            "tuy·ªÉn d·ª•ng": "Th√¥ng tin tuy·ªÉn d·ª•ng ƒë∆∞·ª£c c·∫≠p nh·∫≠t th∆∞·ªùng xuy√™n t·∫°i: <a href='https://www.facebook.com/hulareous' target='_blank'>Huy's Facebook</a>",
            "c√° nh√¢n": "Th√¥ng tin c√° nh√¢n v√† c·∫≠p nh·∫≠t m·ªõi nh·∫•t c√≥ t·∫°i: <a href='https://www.facebook.com/hulareous' target='_blank'>Huy's Facebook</a>"
        };

        const fallbackResponse = "Xin l·ªói, hi·ªán t·∫°i Huy's Assistant ch∆∞a c√≥ d·ªØ li·ªáu v·ªÅ v·∫•n ƒë·ªÅ n√†y. B·∫°n c√≥ th·ªÉ th·ª≠ c√°c t·ª´ kh√≥a nh∆∞: Facebook, Email, Hotline, ho·∫∑c L√£i su·∫•t.";

        function init() {
            const grid = document.getElementById('tileGrid');
            topics.forEach((t) => {
                const tile = document.createElement('div');
                tile.className = 'tile'; tile.id = `tile-${t.id}`; 
                tile.innerHTML = `<div class="tile-title">${t.title}</div>`;
                tile.onclick = (e) => openTopicTab(t, tile);
                grid.appendChild(tile);
            });
            document.addEventListener('keydown', handleGlobalKeys);
            updateFloatingBar();
            initChat();
        }

        function handleSearchInput(e) {
            const keyword = e.target.value.toLowerCase().trim();
            const canvas = document.getElementById('searchCanvas');
            if (e.key === 'Enter') {
                if (keyword.length < 2) { canvas.classList.remove('active'); return; }
                performDeepSearch(keyword); return;
            }
            canvas.classList.remove('active');
        }

        function performDeepSearch(keyword) {
            const canvas = document.getElementById('searchCanvas'); canvas.innerHTML = ''; let resultsFound = 0;
            const createSnippet = (text, query) => {
                const lowerText = text.toLowerCase(); const idx = lowerText.indexOf(query); if (idx === -1) return null;
                const start = Math.max(0, idx - 50); const end = Math.min(text.length, idx + query.length + 50);
                let snippet = text.substring(start, end); const regex = new RegExp(`(${query})`, 'gi');
                return "..." + snippet.replace(regex, '<span class="highlight">$1</span>') + "...";
            };
            const renderResult = (title, snippet, onClickFunc) => {
                const div = document.createElement('div'); div.className = 'search-result-item';
                div.innerHTML = `<div class="res-location">LOCATION: ${title}</div><div class="res-snippet">${snippet}</div>`;
                div.onclick = onClickFunc; canvas.appendChild(div); resultsFound++;
            };
            topics.forEach(topic => {
                const plainText = topic.content.replace(/<[^>]*>/g, ' '); const snippet = createSnippet(plainText, keyword);
                if (snippet) { renderResult(topic.title, snippet, () => { const tile = document.getElementById(`tile-${topic.id}`); openTopicTab(topic, tile); canvas.classList.remove('active'); }); }
            });
            importedFilesData.forEach(file => {
                const snippet = createSnippet(file.content, keyword);
                if (snippet) { renderResult(file.title, snippet, () => { openImportedTabContent(file.title, file.contentHTML); canvas.classList.remove('active'); }); }
            });
            if (resultsFound === 0) canvas.innerHTML = '<div class="no-result">Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu.</div>';
            canvas.classList.add('active');
        }

        function triggerImport() { document.getElementById('fileInput').click(); }
        function processFile(input) {
            const file = input.files[0]; if(!file) return;
            const handleContent = (plainText, htmlContent) => { importedFilesData.push({ title: file.name, content: plainText, contentHTML: htmlContent }); openImportedTabContent(file.name, htmlContent); };
            if (file.name.endsWith('.docx')) {
                const reader = new FileReader(); reader.onload = e => mammoth.convertToHtml({arrayBuffer: e.target.result}).then(r => { const tempDiv = document.createElement('div'); tempDiv.innerHTML = r.value; handleContent(tempDiv.innerText, r.value); }); reader.readAsArrayBuffer(file);
            } else {
                const reader = new FileReader(); reader.onload = e => { const text = e.target.result; const html = text.split('\n').map(l=>`<p>${l}</p>`).join(''); handleContent(text, html); }; reader.readAsText(file, 'UTF-8');
            }
            input.value = '';
        }
        function openImportedTabContent(title, htmlContent) {
            const tabId = `import-${Date.now()}`; const btn = createNewTabElement(tabId, title); document.getElementById('tabList').appendChild(btn);
            const panel = document.createElement('div'); panel.className = 'view-panel'; panel.id = tabId; panel.innerHTML = `<div class="doc-layout"><div class="doc-header"><h1 class="doc-title">${title}</h1></div><div class="doc-content">${htmlContent}</div></div>`;
            document.getElementById('viewport').appendChild(panel); switchTab(tabId);
        }

        function updateFloatingBar() {
            const tabs = Array.from(document.querySelectorAll('.tab')); const bar = document.getElementById('floatingBar'); bar.innerHTML = '';
            const btnA = document.createElement('div'); btnA.className = 'f-item f-action a-btn'; btnA.innerText = 'A'; btnA.onclick = triggerAllTabs; bar.appendChild(btnA);
            const total = tabs.length - 1;
            if (total > 0) {
                const act = tabs.findIndex(t => t.classList.contains('active'));
                const mkBtn = (i) => { const b=document.createElement('div'); b.className='f-item'; if(act===i)b.classList.add('current'); b.innerText=i; b.onclick=()=>tabs[i].click(); bar.appendChild(b); };
                const mkDot = () => { const d=document.createElement('div'); d.className='f-dots'; d.innerText='...'; bar.appendChild(d); };
                if (act === 0) { if (total <= 4) { for(let i=1;i<=total;i++) mkBtn(i); } else { mkBtn(1); mkBtn(2); mkBtn(3); mkDot(); mkBtn(total); } }
                else { mkBtn(1); if(act>2) mkDot(); if(act!==1 && act!==total) mkBtn(act); if(act<total-1) mkDot(); if(total>1) mkBtn(total); }
            }
            const btnDA = document.createElement('div'); btnDA.className = 'f-item f-action da-btn'; btnDA.innerText = 'DA'; btnDA.onclick = closeAllTabs; bar.appendChild(btnDA);
        }
        function triggerAllTabs() { document.getElementById('searchBox').value = ''; topics.forEach((topic, index) => { const tile = document.getElementById(`tile-${topic.id}`); if (tile) { setTimeout(() => { openTopicTab(topic, tile, true); }, index * 200); } }); }
        function closeAllTabs() { const tabs = document.querySelectorAll('.tab'); tabs.forEach(tab => { if (tab.dataset.target !== 'home-view') { document.getElementById(tab.dataset.target)?.remove(); tab.remove(); } }); switchTab('home-view'); }
        
        function animateTileToTab(tileElement, tabElement, onComplete) {
            const startRect = tileElement.getBoundingClientRect(); const endRect = tabElement.getBoundingClientRect();
            const ghost = document.createElement('div'); ghost.className = 'morph-ghost'; ghost.innerHTML = tileElement.innerHTML; 
            ghost.style.left = startRect.left + 'px'; ghost.style.top = startRect.top + 'px'; ghost.style.width = startRect.width + 'px'; ghost.style.height = startRect.height + 'px';
            ghost.style.fontFamily = "'Space Grotesk', sans-serif"; ghost.style.fontWeight = "700"; ghost.style.textTransform = "uppercase"; ghost.style.color = "#fff"; ghost.style.fontSize = "1rem";
            document.body.appendChild(ghost);
            requestAnimationFrame(() => { ghost.style.left = endRect.left + 'px'; ghost.style.top = endRect.top + 'px'; ghost.style.width = endRect.width + 'px'; ghost.style.height = endRect.height + 'px'; ghost.style.opacity = '0.5'; ghost.style.fontSize = "0.8rem"; });
            setTimeout(() => { ghost.remove(); if (onComplete) onComplete(); }, 600);
        }

        /* --- UPDATED: IMAGE FALLBACK IN OPEN TOPIC TAB --- */
        function openTopicTab(topic, tileElement, stayOnHome = false) {
            const tabId = `topic-${topic.id}`; if(document.getElementById(tabId)) { if (!stayOnHome) switchTab(tabId); return; }
            
            // Added onerror fallback to a reliable placeholder
            const html = `
                <div class="doc-layout">
                    <div class="doc-header"><h1 class="doc-title">${topic.title}</h1></div>
                    <img src="${topic.img}" class="doc-image" onerror="this.src='https://placehold.co/1000x350/2c2c2c/ffffff?text=Image+Unavailable'">
                    <div class="doc-content">${topic.content}</div>
                </div>`;
            
            const tabBtn = createNewTabElement(tabId, topic.title); tabBtn.classList.add('invisible-waiting'); document.getElementById('tabList').appendChild(tabBtn);
            const panel = document.createElement('div'); panel.className = 'view-panel'; panel.id = tabId; panel.innerHTML = html; document.getElementById('viewport').appendChild(panel);
            tabBtn.scrollIntoView({behavior: "auto", block: "nearest", inline: "end"}); updateFloatingBar();
            if (tileElement) { animateTileToTab(tileElement, tabBtn, () => { tabBtn.classList.remove('invisible-waiting'); if (!stayOnHome) switchTab(tabId); }); } else { tabBtn.classList.remove('invisible-waiting'); if (!stayOnHome) switchTab(tabId); }
        }

        function createNewTabElement(id, title) { const tabBtn = document.createElement('div'); tabBtn.className = 'tab'; tabBtn.dataset.target = id; tabBtn.innerHTML = `<span title="${title}">${title}</span><div class="tab-close" onclick="closeTab('${id}', event)">‚úï</div>`; tabBtn.onclick = () => switchTab(id); return tabBtn; }
        function switchTab(id) { document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); document.querySelectorAll('.view-panel').forEach(p => p.classList.remove('active')); const t = document.querySelector(`.tab[data-target="${id}"]`); const p = document.getElementById(id); if(t && p) { t.classList.add('active'); p.classList.add('active'); t.scrollIntoView({behavior:'smooth', inline:'center'}); updateFloatingBar(); } }
        function closeTab(id, e) { if(e) e.stopPropagation(); const t = document.querySelector(`.tab[data-target="${id}"]`); const p = document.getElementById(id); if(t.classList.contains('active')) switchTab('home-view'); t.remove(); p.remove(); updateFloatingBar(); }
        function handleGlobalKeys(e) { const activeTag = document.activeElement.tagName; if (activeTag === 'INPUT' || activeTag === 'TEXTAREA') return; const tabs = Array.from(document.querySelectorAll('.tab')); if (!tabs.length) return; const activeIndex = tabs.findIndex(t => t.classList.contains('active')); if (activeIndex === -1) return; if (e.key === 'ArrowRight') tabs[(activeIndex + 1) % tabs.length].click(); else if (e.key === 'ArrowLeft') tabs[(activeIndex - 1 + tabs.length) % tabs.length].click(); else if (e.key === 'Backspace') { const targetId = tabs[activeIndex].dataset.target; if (targetId !== 'home-view') closeTab(targetId, null); } }

        function toggleChat() { document.getElementById('chatWindow').classList.toggle('open'); }
        
        function initChat() {
            const body = document.getElementById('chatBody');
            const indicator = document.getElementById('typingIndicator');
            while(body.firstChild && body.firstChild !== indicator) body.removeChild(body.firstChild);
            addBotMessage("Ch√†o b·∫°n! T√¥i l√† Huy's Assistant. T√¥i c√≥ th·ªÉ h·ªó tr·ª£ th√¥ng tin g√¨ cho b·∫°n?");
            
            const suggestions = document.createElement('div');
            suggestions.className = 'suggestions';
            const keys = ["Li√™n h·ªá", "Facebook", "L√£i su·∫•t", "Th·∫ª t√≠n d·ª•ng", "Email"];
            keys.forEach(k => {
                const chip = document.createElement('div'); chip.className = 'chip'; chip.innerText = k;
                chip.onclick = () => { document.getElementById('chatInput').value = k; sendMsg(); };
                suggestions.appendChild(chip);
            });
            body.insertBefore(suggestions, indicator);
        }

        function sendMsg() {
            const inp = document.getElementById('chatInput'); const txt = inp.value.trim(); if(!txt) return;
            addUserMessage(txt); inp.value = ''; processBotReply(txt);
        }

        function addUserMessage(text) {
            const body = document.getElementById('chatBody'); const indicator = document.getElementById('typingIndicator');
            const div = document.createElement('div'); div.className = 'msg user'; div.innerText = text;
            body.insertBefore(div, indicator); body.scrollTop = body.scrollHeight;
        }

        function addBotMessage(text) {
            const body = document.getElementById('chatBody'); const indicator = document.getElementById('typingIndicator');
            const div = document.createElement('div'); div.className = 'msg bot'; 
            div.innerHTML = text; 
            body.insertBefore(div, indicator); body.scrollTop = body.scrollHeight;
        }

        function processBotReply(userText) {
            const indicator = document.getElementById('typingIndicator');
            indicator.style.display = 'flex'; const body = document.getElementById('chatBody'); body.scrollTop = body.scrollHeight;
            
            const lowerText = userText.toLowerCase();
            const weakKeys = ['huy', 'nexus', 'xin ch√†o', 'hi', 'ch√†o', 'b·∫°n ∆°i', 'ad', 'admin'];
            
            let foundKeywords = [];
            for (let key in botBrain) {
                const idx = lowerText.indexOf(key);
                if (idx !== -1) {
                    foundKeywords.push({ key: key, index: idx, isWeak: weakKeys.includes(key), content: botBrain[key] });
                }
            }
            foundKeywords.sort((a, b) => a.index - b.index);

            const hasStrongKey = foundKeywords.some(item => !item.isWeak);
            let finalKeywords = hasStrongKey ? foundKeywords.filter(item => !item.isWeak) : foundKeywords;

            let uniqueReplies = [];
            let seenContent = new Set();
            finalKeywords.forEach(item => {
                if (!seenContent.has(item.content)) { uniqueReplies.push(item.content); seenContent.add(item.content); }
            });

            setTimeout(() => {
                indicator.style.display = 'none';
                if (uniqueReplies.length > 0) {
                    uniqueReplies.forEach((reply, index) => { setTimeout(() => { addBotMessage(reply); }, index * 600); });
                } else {
                    addBotMessage(fallbackResponse);
                }
            }, 1000);
        }

        init();
    </script>
</body>
</html>