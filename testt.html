<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Huy's Nexus | Story Mode</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Space+Grotesk:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Word Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>

    <style>
        /* --- 1. CORE VARIABLES --- */
        :root {
            --bg-dark: #0a0b1e;
            --text-light: #ffffff;
            --accent-primary: #4cc9f0;
            --accent-secondary: #f72585;
            --doc-bg: #fdfbf7;
            --doc-text: #2c2c2c;
            --doc-accent: #c0a080;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Manrope', sans-serif; 
            background-color: var(--bg-dark); 
            color: var(--text-light); 
            overflow: hidden; 
            height: 100vh;
            user-select: none;
        }

        /* --- 2. HEADER & TABS --- */
        .edge-chrome {
            height: 50px; background: #1e1e2e; display: flex; align-items: center;
            padding: 0 10px; border-bottom: 1px solid #333; position: fixed; top: 0; width: 100%; z-index: 1000;
        }
        .tab-list { display: flex; gap: 6px; flex: 1; overflow-x: auto; align-items: center; height: 100%; padding-top: 6px; scroll-behavior: smooth; }
        .tab-list::-webkit-scrollbar { height: 0; }
        .tab {
            background: #2a2a3a; color: #ccc; padding: 0 12px; height: 38px; border-radius: 8px 8px 0 0; font-size: 13px;
            display: flex; align-items: center; gap: 8px; cursor: pointer; transition: background 0.2s;
            max-width: 200px; min-width: 120px; border-right: 1px solid #333; position: relative; opacity: 1; 
        }
        .tab.invisible-waiting { opacity: 0; }
        .tab span { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; flex: 1; }
        .tab:hover { background: #3a3a4a; }
        .tab.active { background: var(--doc-bg); color: #000; font-weight: 600; }
        .tab[data-target="home-view"].active { background: #3a3a4a; color: #fff; }
        .tab-close { width: 16px; height: 16px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; opacity: 0.6; }
        .tab-close:hover { background: #ff5f57; color: white; opacity: 1; }
        .add-btn { width: 30px; height: 30px; margin-left: 10px; border-radius: 4px; color: #aaa; display: flex; align-items: center; justify-content: center; font-size: 20px; cursor: pointer; flex-shrink: 0; }
        .add-btn:hover { background: rgba(255,255,255,0.1); color: white; }

        /* --- 3. SMART FLOATING BAR --- */
        .floating-bar {
            position: fixed; top: 65px; left: 20px; z-index: 9998;
            background: rgba(15, 15, 25, 0.85); backdrop-filter: blur(15px); padding: 4px 6px; border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15); display: flex; align-items: center; gap: 4px;
            opacity: 0.6; transition: all 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .floating-bar:hover { opacity: 1; transform: translateY(2px); background: rgba(15, 15, 25, 0.95); }
        .f-item { min-width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 600; font-family: 'Space Grotesk', sans-serif; cursor: pointer; color: #888; transition: 0.2s; flex-shrink: 0; }
        .f-item:hover { color: white; background: rgba(255,255,255,0.1); }
        .f-item.current { background: var(--text-light); color: #000; font-weight: 800; box-shadow: 0 0 8px rgba(255, 255, 255, 0.3); }
        .f-dots { color: #555; font-size: 0.8rem; padding: 0 2px; cursor: default; }
        .f-action { font-size: 0.7rem; width: 28px; height: 28px; border-radius: 50%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #aaa; font-weight: 700; }
        .f-action.a-btn:hover { background: var(--accent-primary); color: #000; border-color: transparent; }
        .f-action.da-btn:hover { background: var(--accent-secondary); color: #fff; border-color: transparent; }

        /* --- 4. IMPORT MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(8px);
            z-index: 10000; display: flex; align-items: center; justify-content: center;
            opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; pointer-events: none;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; pointer-events: all; }
        .modal-box { background: #1a1a2e; width: 500px; padding: 30px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 20px 60px rgba(0,0,0,0.5); transform: scale(0.9); transition: transform 0.3s; color: #fff; }
        .modal-overlay.active .modal-box { transform: scale(1); }
        .modal-header { font-family: 'Space Grotesk', sans-serif; font-size: 1.5rem; margin-bottom: 20px; color: white; text-align: center; text-transform: uppercase; letter-spacing: 2px; }
        .toggle-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; background: rgba(255,255,255,0.05); padding: 15px 20px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); }
        .toggle-label { color: #ccc; font-size: 0.95rem; font-weight: 500; }
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #444; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent-primary); }
        input:checked + .slider:before { transform: translateX(24px); }
        .upload-grid { display: flex; gap: 15px; margin-bottom: 25px; }
        .upload-zone { flex: 1; height: 140px; border: 2px dashed rgba(255,255,255,0.2); border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; color: #888; font-size: 0.8rem; text-align: center; position: relative; overflow: hidden; background: rgba(255,255,255,0.02); }
        .upload-zone:hover { border-color: var(--accent-primary); color: var(--accent-primary); background: rgba(76, 201, 240, 0.05); }
        .upload-zone.disabled { opacity: 0.3; pointer-events: none; background: #111; border-color: #333; }
        .preview-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.6; border-radius: 10px;}
        .modal-actions { display: flex; gap: 15px; }
        .btn-modal { flex: 1; padding: 15px; border-radius: 12px; border: none; cursor: pointer; font-weight: 700; transition: 0.2s; font-family: 'Manrope', sans-serif; text-transform: uppercase; letter-spacing: 1px; }
        .btn-cancel { background: rgba(255,255,255,0.1); color: #ccc; }
        .btn-cancel:hover { background: rgba(255,255,255,0.2); color: #fff; }
        .btn-confirm { background: linear-gradient(135deg, var(--accent-primary), #4361ee); color: #fff; }

        /* --- 5. VIEWPORT --- */
        .viewport { margin-top: 50px; height: calc(100vh - 50px); position: relative; background: #000; }
        .view-panel { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; background: var(--doc-bg); color: var(--doc-text); }
        .view-panel.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

        #home-view { background: linear-gradient(rgba(10,11,30,0.92), rgba(10,11,30,0.96)), url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072&auto=format&fit=crop') no-repeat center center fixed; background-size: cover; color: white; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; padding-bottom: 5vh; }
        .home-content { width: 100%; display: flex; flex-direction: column; align-items: center; position: relative; }
        .logo { font-family: 'Space Grotesk', sans-serif; font-size: 5.5rem; font-weight: 700; background: linear-gradient(to right, #fff, #4cc9f0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 50px; letter-spacing: -3px; text-align: center; text-transform: lowercase; filter: drop-shadow(0 0 20px rgba(76, 201, 240, 0.2)); }
        .search-area { position: relative; width: 50%; margin-bottom: 70px; display: flex; flex-direction: column; align-items: center; }
        .search-box { width: 100%; padding: 20px 30px; background: rgba(255,255,255,0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); border-radius: 2px; color: white; font-size: 1.2rem; outline: none; transition: 0.3s; text-align: center; font-family: 'Space Grotesk', sans-serif; letter-spacing: 2px; text-transform: uppercase; }
        .search-box:focus { background: rgba(255,255,255,0.08); border-color: var(--accent-primary); box-shadow: 0 0 30px rgba(76, 201, 240, 0.1); }
        
        /* SEARCH CANVAS */
        #searchCanvas { position: absolute; top: 100%; left: 0; width: 100%; max-height: 0; opacity: 0; background: rgba(10, 11, 30, 0.95); backdrop-filter: blur(30px); border: 1px solid rgba(255,255,255,0.1); border-top: none; overflow-y: auto; transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); z-index: 999; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        #searchCanvas.active { max-height: 400px; opacity: 1; margin-top: 10px; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; }
        #searchCanvas::-webkit-scrollbar { width: 6px; }
        #searchCanvas::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        .search-result-item { padding: 20px 30px; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; transition: 0.2s; text-align: left; }
        .search-result-item:hover { background: rgba(255,255,255,0.05); border-left: 3px solid var(--accent-primary); }
        .res-location { font-family: 'Space Grotesk', sans-serif; font-size: 0.8rem; color: var(--accent-primary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .res-snippet { font-size: 0.95rem; color: #ccc; line-height: 1.5; font-family: 'Manrope', sans-serif; }
        .highlight { background: rgba(247, 37, 133, 0.3); color: #fff; padding: 0 2px; border-radius: 2px; font-weight: bold; }
        .no-result { padding: 30px; color: #666; font-style: italic; }

        /* GRID */
        .tile-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 25px; padding: 0; width: 100%; max-width: 1000px; }
        .tile { aspect-ratio: 1.8; background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255,255,255,0.08); border-radius: 4px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: all 0.5s; padding: 10px; text-align: center; position: relative; overflow: hidden; }
        .tile::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(120deg, transparent, rgba(255,255,255,0.05), transparent); transform: translateX(-100%); transition: 0.6s; }
        .tile:hover { background: rgba(255, 255, 255, 0.06); transform: translateY(-5px); border-color: rgba(255,255,255,0.4); box-shadow: 0 15px 40px rgba(0,0,0,0.4); }
        .tile:hover::before { transform: translateX(100%); }
        .tile-title { font-family: 'Space Grotesk', sans-serif; font-size: 0.95rem; font-weight: 600; color: #777; text-transform: uppercase; letter-spacing: 1.5px; transition: 0.4s; }
        .tile:hover .tile-title { color: #fff; letter-spacing: 3px; text-shadow: 0 0 15px rgba(255,255,255,0.6); }
        .tile.plus-tile { border: 2px dashed rgba(255,255,255,0.15); }
        .tile.plus-tile:hover { border-color: var(--accent-primary); background: rgba(76, 201, 240, 0.05); }
        .plus-icon { font-size: 3rem; color: rgba(255,255,255,0.3); transition: 0.3s; font-weight: 200; }
        .tile.plus-tile:hover .plus-icon { color: #fff; transform: scale(1.2) rotate(90deg); }
        .morph-ghost { position: fixed; z-index: 9999; background: rgba(255, 255, 255, 0.1); border: 1px solid var(--accent-primary); border-radius: 4px; pointer-events: none; transform-origin: center; transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1); display: flex; align-items: center; justify-content: center; overflow: hidden; }

        /* --- 6. COMPACT SPLIT LAYOUT --- */
        .doc-layout { display: flex; width: 100%; height: 100%; overflow: hidden; background: #fff; }
        .doc-visual { flex: 0 0 40%; height: 100%; position: relative; overflow: hidden; border-right: 1px solid #eee; }
        .doc-image { width: 100%; height: 100%; object-fit: cover; filter: sepia(0.1) brightness(0.95); transition: 0.5s; }
        .doc-visual:hover .doc-image { transform: scale(1.05); }
        .doc-content-box { flex: 1; padding: 50px 60px; display: flex; flex-direction: column; justify-content: center; overflow-y: auto; }
        .doc-content-box::-webkit-scrollbar { width: 0; }
        .doc-header { margin-bottom: 30px; border-bottom: 2px solid var(--doc-accent); padding-bottom: 15px; display: inline-block; }
        .doc-title { font-family: 'Playfair Display', serif; font-size: 2.5rem; color: #111; margin: 0; line-height: 1.1; }
        .doc-body { font-size: 1.05rem; line-height: 1.6; color: #333; }
        .doc-body h2 { font-family: 'Manrope', sans-serif; font-weight: 700; font-size: 1.2rem; margin-top: 20px; margin-bottom: 10px; color: var(--accent-primary); text-transform: uppercase; letter-spacing: 1px; }
        .doc-body ul { list-style: none; padding: 0; margin-bottom: 20px; }
        .doc-body ul li { padding-left: 15px; position: relative; margin-bottom: 8px; }
        .doc-body ul li::before { content: "‚Ä¢"; color: var(--doc-accent); font-weight: bold; position: absolute; left: 0; }
        .doc-highlight { background: #f8f9fa; padding: 15px; border-left: 4px solid #f72585; margin-top: 20px; font-style: italic; color: #555; font-size: 0.95rem; }
        .doc-layout.no-image .doc-visual { display: none; }
        .doc-layout.no-image .doc-content-box { padding: 60px 100px; }
        .doc-layout.no-image .doc-title { font-size: 3.5rem; }

        /* --- 7. CHATBOX UI --- */
        .chat-widget { position: fixed; bottom: 30px; right: 30px; z-index: 9999; touch-action: none; }
        .chat-btn { width: 70px; height: 70px; border-radius: 50%; background: white; border: 3px solid #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.2); cursor: grab; transition: transform 0.1s; display: flex; align-items: center; justify-content: center; }
        .chat-btn:active { cursor: grabbing; transform: scale(0.95); }
        .chat-btn img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; pointer-events: none; }
        .chat-window { position: absolute; width: 380px; height: 600px; background: #fff; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); display: flex; flex-direction: column; transform: scale(0); transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28), opacity 0.3s; opacity: 0; pointer-events: none; }
        .chat-window.open { transform: scale(1); opacity: 1; pointer-events: all; }
        .chat-header { background: linear-gradient(135deg, #4f46e5, #06b6d4); color: white; padding: 20px; display: flex; align-items: center; gap: 15px; cursor: default; }
        .chat-body { flex: 1; padding: 20px; background: #f9fafb; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; cursor: default; }
        .msg { max-width: 80%; padding: 12px 16px; border-radius: 16px; font-size: 0.95rem; line-height: 1.5; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
        .msg.bot { background: white; align-self: flex-start; border-bottom-left-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); color: #333; }
        .msg.bot a { color: #2563eb; font-weight: 700; text-decoration: none; border-bottom: 2px solid rgba(37, 99, 235, 0.2); transition: 0.2s; }
        .msg.bot a:hover { color: #f72585; border-color: #f72585; }
        .msg.user { background: #4f46e5; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        .chat-footer { padding: 15px; background: white; border-top: 1px solid #eee; display: flex; gap: 10px; cursor: default; }
        .chat-input { flex: 1; padding: 10px 15px; border-radius: 20px; border: 1px solid #ddd; outline: none; }
        .chat-input:focus { border-color: #4f46e5; }
        .typing-indicator { display: none; gap: 4px; padding: 12px 16px; background: white; width: fit-content; border-radius: 16px; align-self: flex-start; border-bottom-left-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .dot { width: 6px; height: 6px; background: #bbb; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .suggestions { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
        .chip { background: #e0e7ff; color: #4338ca; padding: 6px 12px; border-radius: 15px; font-size: 0.85rem; cursor: pointer; transition: 0.2s; border: 1px solid transparent; }
        .chip:hover { background: #c7d2fe; border-color: #4338ca; }

        #fileUploadInput, #imageUploadInput { display: none; }
    </style>
</head>
<body>

    <div class="edge-chrome">
        <div class="tab-list" id="tabList">
            <div class="tab active" data-target="home-view" onclick="switchTab('home-view')">
                <span>üè† Home</span>
            </div>
        </div>
        <div class="add-btn" onclick="openImportModal()">+</div>
    </div>

    <div class="floating-bar" id="floatingBar"></div>

    <div class="modal-overlay" id="importModal">
        <div class="modal-box">
            <h2 class="modal-header">T·∫†O TAB M·ªöI</h2>
            <div class="toggle-row">
                <span class="toggle-label">Hi·ªÉn th·ªã ·∫£nh b√¨a (Banner)</span>
                <label class="switch"><input type="checkbox" id="imgToggle" checked onchange="toggleImageUpload(this)"><span class="slider"></span></label>
            </div>
            <div class="upload-grid">
                <div class="upload-zone" id="imgZone" onclick="document.getElementById('imageUploadInput').click()">
                    <div class="upload-icon">üñºÔ∏è</div><div>Ch·ªçn ·∫¢nh</div><img id="previewImg" class="preview-img" style="display:none;"><input type="file" id="imageUploadInput" accept="image/*" onchange="handleImageSelect(this)">
                </div>
                <div class="upload-zone" onclick="document.getElementById('fileUploadInput').click()">
                    <div class="upload-icon">üìÑ</div><div>Ch·ªçn T√†i Li·ªáu</div><div id="fileNameDisplay" class="file-name"></div><input type="file" id="fileUploadInput" accept=".html,.txt,.docx" onchange="handleDocSelect(this)">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-modal btn-cancel" onclick="closeImportModal()">H·ªßy</button>
                <button class="btn-modal btn-confirm" onclick="confirmImport()">T·∫°o Tab</button>
            </div>
        </div>
    </div>

    <div class="viewport" id="viewport">
        <div id="home-view" class="view-panel active">
            <div class="home-content">
                <div class="logo">huy's nexus</div>
                <div class="search-area">
                    <input type="text" class="search-box" id="searchBox" placeholder="ENTER KEYWORD TO ACCESS..." onkeyup="handleSearchInput(event)">
                    <div id="searchCanvas"></div>
                </div>
                <div class="tile-grid" id="tileGrid"></div>
            </div>
        </div>
    </div>

    <div class="chat-widget" id="draggableChat">
        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                <img src="https://cdn-icons-png.flaticon.com/512/4712/4712035.png" style="width:40px;border-radius:50%">
                <div><h4 style="margin:0">Huy's Assistant</h4><small>S·∫µn s√†ng h·ªó tr·ª£</small></div>
            </div>
            <div class="chat-body" id="chatBody">
                <div class="typing-indicator" id="typingIndicator"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
            </div>
            <div class="chat-footer">
                <input type="text" class="chat-input" id="chatInput" placeholder="Nh·∫≠p c√¢u h·ªèi..." onkeypress="if(event.key==='Enter') sendMsg()">
                <div onclick="sendMsg()" style="cursor:pointer;color:blue;font-size:1.2rem;">‚û§</div>
            </div>
        </div>
        <div class="chat-btn" id="chatBtn"><img src="https://cdn-icons-png.flaticon.com/512/4712/4712035.png"></div>
    </div>

    <script>
        /* --- STORYTELLING DATA - REWRITTEN & UPGRADED IMAGES --- */
        let topics = [
            { id: 1, title: "1. B·ªêI C·∫¢NH", img: "https://images.unsplash.com/photo-1550751827-4bd374c3f58b?auto=format&fit=crop&w=1000&q=80", content: `<h2>K·ª∑ Nguy√™n S·ªë H√≥a</h2><p>Kh√°ch h√†ng ng√†y nay mong ƒë·ª£i d·ªãch v·ª• t√†i ch√≠nh "m·ªçi l√∫c, m·ªçi n∆°i". C√°c chi nh√°nh v·∫≠t l√Ω d·∫ßn nh∆∞·ªùng ch·ªó cho n·ªÅn t·∫£ng s·ªë.</p><h2>Th√°ch Th·ª©c</h2><ul><li>Kh·ªëi l∆∞·ª£ng giao d·ªãch kh·ªïng l·ªì 24/7.</li><li>Nhu c·∫ßu h·ªó tr·ª£ t·ª©c th√¨ (Instant Gratification).</li><li>√Åp l·ª±c v·ªÅ b·∫£o m·∫≠t d·ªØ li·ªáu.</li></ul>` },
            { id: 2, title: "2. VAI TR√í AI", img: "https://images.unsplash.com/photo-1620712943543-bcc4688e7485?auto=format&fit=crop&w=1000&q=80", content: `<h2>B·ªô N√£o C·ªßa Ng√¢n H√†ng</h2><p>AI kh√¥ng ch·ªâ l√† c√¥ng c·ª•, n√≥ l√† n·ªÅn t·∫£ng v·∫≠n h√†nh c·ªßa ng√¢n h√†ng s·ªë hi·ªán ƒë·∫°i. AI hi·ªán di·ªán trong m·ªçi ƒëi·ªÉm ch·∫°m kh√°ch h√†ng.</p><h2>Tr·ª• C·ªôt Ch√≠nh</h2><ul><li>Machine Learning: D·ª± b√°o r·ªßi ro.</li><li>NLP: Hi·ªÉu ng√¥n ng·ªØ con ng∆∞·ªùi.</li><li>Computer Vision: X√°c th·ª±c h√¨nh ·∫£nh eKYC.</li></ul>` },
            { id: 3, title: "3. CHATBOT GENAI", img: "https://images.unsplash.com/photo-1677442136019-21780ecad995?auto=format&fit=crop&w=1000&q=80", content: `<h2>Si√™u Tr·ª£ L√Ω ·∫¢o</h2><p>Generative AI cho ph√©p Chatbot t·ª± t·∫°o c√¢u tr·∫£ l·ªùi t·ª± nhi√™n thay v√¨ d√πng k·ªãch b·∫£n c·ª©ng nh·∫Øc.</p><h2>NƒÉng L·ª±c M·ªõi</h2><ul><li>Th·∫•u c·∫£m v·ªõi c·∫£m x√∫c kh√°ch h√†ng.</li><li>Ghi nh·ªõ ng·ªØ c·∫£nh h·ªôi tho·∫°i d√†i.</li><li>Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ ph·ª©c t·∫°p kh√¥ng c·∫ßn con ng∆∞·ªùi.</li></ul>` },
            { id: 4, title: "4. C√îNG NGH·ªÜ NLP", img: "https://images.unsplash.com/photo-1555949963-ff9fe0c870eb?auto=format&fit=crop&w=1000&q=80", content: `<h2>X·ª≠ L√Ω Ng√¥n Ng·ªØ T·ª± Nhi√™n</h2><p>NLP l√† c·∫ßu n·ªëi gi√∫p m√°y t√≠nh "ƒë·ªçc hi·ªÉu" √Ω ƒë·ªãnh (Intent) c·ªßa con ng∆∞·ªùi qua vƒÉn b·∫£n ho·∫∑c gi·ªçng n√≥i.</p><h2>·ª®ng D·ª•ng</h2><ul><li>Ph√¢n t√≠ch √Ω ƒë·ªãnh: Mu·ªën chuy·ªÉn ti·ªÅn hay khi·∫øu n·∫°i?</li><li>Tr√≠ch xu·∫•t th√¥ng tin: S·ªë ti·ªÅn, t√™n ng∆∞·ªùi nh·∫≠n.</li><li>Voice Banking: Ra l·ªánh b·∫±ng gi·ªçng n√≥i.</li></ul>` },
            { id: 5, title: "5. B·∫¢O M·∫¨T & EKYC", img: "https://images.unsplash.com/photo-1563986768609-322da13575f3?auto=format&fit=crop&w=1000&q=80", content: `<h2>ƒê·ªãnh Danh ƒêi·ªán T·ª≠</h2><p>eKYC cho ph√©p m·ªü t√†i kho·∫£n 100% online an to√†n tuy·ªát ƒë·ªëi nh·ªù AI.</p><h2>C√¥ng Ngh·ªá L√µi</h2><ul><li>Liveness Detection: Ch·ªëng gi·∫£ m·∫°o khu√¥n m·∫∑t (Face Spoofing).</li><li>OCR: T·ª± ƒë·ªông ƒë·ªçc d·ªØ li·ªáu t·ª´ gi·∫•y t·ªù t√πy th√¢n.</li><li>Fraud Detection: Ch·∫∑n giao d·ªãch ƒë√°ng ng·ªù t·ª©c th√¨.</li></ul>` },
            { id: 6, title: "6. C√Å NH√ÇN H√ìA", img: "https://images.unsplash.com/photo-1551288049-bebda4e38f71?auto=format&fit=crop&w=1000&q=80", content: `<h2>Tr·∫£i Nghi·ªám May ƒêo</h2><p>AI ph√¢n t√≠ch d·ªØ li·ªáu l·ªõn ƒë·ªÉ cung c·∫•p d·ªãch v·ª• ph√π h·ª£p ri√™ng cho t·ª´ng c√° nh√¢n (Hyper-personalization).</p><h2>V√≠ D·ª•</h2><ul><li>G·ª£i √Ω th·∫ª t√≠n d·ª•ng d·ª±a tr√™n th√≥i quen mua s·∫Øm.</li><li>C·∫£nh b√°o chi ti√™u v∆∞·ª£t h·∫°n m·ª©c.</li><li>Ch√∫c m·ª´ng sinh nh·∫≠t k√®m ∆∞u ƒë√£i ri√™ng.</li></ul>` },
            { id: 7, title: "7. T·ª∞ ƒê·ªòNG H√ìA", img: "https://images.unsplash.com/photo-1518186285589-2f7649de83e0?auto=format&fit=crop&w=1000&q=80", content: `<h2>H·∫≠u Ph∆∞∆°ng V·ªØng Ch·∫Øc</h2><p>RPA (Robotic Process Automation) l√† c√°c robot ph·∫ßn m·ªÅm l√†m vi·ªác √¢m th·∫ßm ph√≠a sau ƒë·ªÉ h·ªó tr·ª£ Chatbot.</p><h2>Quy Tr√¨nh</h2><ul><li>Chatbot nh·∫≠n l·ªánh kh√≥a th·∫ª.</li><li>RPA truy c·∫≠p Core Banking th·ª±c hi·ªán l·ªánh.</li><li>Chatbot b√°o k·∫øt qu·∫£ cho kh√°ch.</li></ul>` },
            { id: 8, title: "8. M√î H√åNH LAI", img: "https://images.unsplash.com/photo-1535378437327-1e855d487340?auto=format&fit=crop&w=1000&q=80", content: `<h2>AI + Con Ng∆∞·ªùi</h2><p>AI kh√¥ng thay th·∫ø ho√†n to√†n con ng∆∞·ªùi. M√¥ h√¨nh hi·ªáu qu·∫£ nh·∫•t l√† s·ª± ph·ªëi h·ª£p nh·ªãp nh√†ng (Human-in-the-loop).</p><h2>Ph√¢n C√¥ng</h2><ul><li>AI: X·ª≠ l√Ω 80% t√°c v·ª• l·∫∑p l·∫°i, th∆∞·ªùng quy.</li><li>Con ng∆∞·ªùi: X·ª≠ l√Ω 20% ca kh√≥, ƒë√≤i h·ªèi s·ª± th·∫•u c·∫£m v√† linh ho·∫°t cao.</li></ul>` },
            { id: 9, title: "9. K·∫æT LU·∫¨N", img: "https://images.unsplash.com/photo-1485827404703-89b55fcc595e?auto=format&fit=crop&w=1000&q=80", content: `<h2>T∆∞∆°ng Lai C·ªßa Fintech</h2><p>Ng√¢n h√†ng trong t∆∞∆°ng lai s·∫Ω "v√¥ h√¨nh" (Invisible Banking), t√≠ch h·ª£p s√¢u v√†o cu·ªôc s·ªëng h√†ng ng√†y.</p><h2>T·∫ßm Nh√¨n</h2><ul><li>T√†i ch√≠nh t·ª± h√†nh (Autonomous Finance).</li><li>B·∫£o m·∫≠t l∆∞·ª£ng t·ª≠.</li><li>Tr·∫£i nghi·ªám si√™u c√° nh√¢n h√≥a theo th·ªùi gian th·ª±c.</li></ul>` }
        ];

        let importedFilesData = [];
        let selectedDocFile = null;
        let selectedImgFile = null;

        /* --- INIT --- */
        function init() {
            renderGrid();
            document.addEventListener('keydown', handleGlobalKeys);
            updateFloatingBar();
            initChat();
            initDraggableChat();
        }

        /* --- GRID --- */
        function renderGrid() {
            const grid = document.getElementById('tileGrid');
            grid.innerHTML = '';
            const visibleTopics = topics.slice(0, 9);
            visibleTopics.forEach((t) => {
                const tile = document.createElement('div');
                tile.className = 'tile'; tile.id = `tile-${t.id}`; 
                tile.innerHTML = `<div class="tile-title">${t.title}</div>`;
                tile.onclick = (e) => { if(document.getElementById('draggableChat').style.transition === 'none') return; openTopicTab(t, tile); };
                grid.appendChild(tile);
            });
            const plusTile = document.createElement('div');
            plusTile.className = 'tile plus-tile';
            plusTile.innerHTML = `<div class="plus-icon">+</div>`;
            plusTile.title = "Th√™m n·ªôi dung m·ªõi";
            plusTile.onclick = openImportModal; 
            grid.appendChild(plusTile);
        }

        /* --- IMPORT MODAL --- */
        function openImportModal() {
            document.getElementById('imgToggle').checked = true;
            toggleImageUpload(document.getElementById('imgToggle'));
            document.getElementById('previewImg').style.display = 'none';
            document.getElementById('fileNameDisplay').innerText = '';
            document.getElementById('imageUploadInput').value = '';
            document.getElementById('fileUploadInput').value = '';
            selectedDocFile = null; selectedImgFile = null;
            document.getElementById('importModal').classList.add('active');
        }
        function closeImportModal() { document.getElementById('importModal').classList.remove('active'); }
        function toggleImageUpload(checkbox) {
            const zone = document.getElementById('imgZone');
            if (checkbox.checked) zone.classList.remove('disabled');
            else { zone.classList.add('disabled'); selectedImgFile = null; }
        }
        function handleImageSelect(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => { selectedImgFile = e.target.result; const prev = document.getElementById('previewImg'); prev.src = selectedImgFile; prev.style.display = 'block'; };
                reader.readAsDataURL(file);
            }
        }
        function handleDocSelect(input) {
            selectedDocFile = input.files[0];
            if (selectedDocFile) document.getElementById('fileNameDisplay').innerText = selectedDocFile.name;
        }
        function confirmImport() {
            if (!selectedDocFile) { alert("Vui l√≤ng ch·ªçn file t√†i li·ªáu!"); return; }
            const file = selectedDocFile;
            const useImage = document.getElementById('imgToggle').checked;
            const finalImg = useImage && selectedImgFile ? selectedImgFile : null;
            const finishImport = (plainText, rawHtml) => {
                let formattedHtml = rawHtml;
                if (!rawHtml.includes('<h2>')) formattedHtml = `<h2>1. T·ªïng quan - ${file.name}</h2>${rawHtml}`;
                const title = file.name.replace(/\.[^/.]+$/, "").toUpperCase();
                importedFilesData.push({ title: title, content: plainText, contentHTML: formattedHtml });
                const newTopic = { id: Date.now(), title: title, img: finalImg, content: formattedHtml };
                topics.unshift(newTopic);
                renderGrid(); openTopicTab(newTopic); closeImportModal();
            };
            if (file.name.endsWith('.docx')) {
                const reader = new FileReader(); reader.onload = e => mammoth.convertToHtml({arrayBuffer: e.target.result}).then(r => { const tempDiv = document.createElement('div'); tempDiv.innerHTML = r.value; finishImport(tempDiv.innerText, r.value); }); reader.readAsArrayBuffer(file);
            } else {
                const reader = new FileReader(); reader.onload = e => { const text = e.target.result; const html = text.split('\n').map(l=>`<p>${l}</p>`).join(''); finishImport(text, html); }; reader.readAsText(file, 'UTF-8');
            }
        }

        /* --- COMPACT SPLIT TAB --- */
        function openTopicTab(topic, tileElement, stayOnHome = false) {
            const tabId = `topic-${topic.id}`; 
            if(document.getElementById(tabId)) { if (!stayOnHome) switchTab(tabId); return; }
            let html = '';
            if (topic.img) {
                html = `
                    <div class="doc-layout">
                        <div class="doc-visual"><img src="${topic.img}" class="doc-image" onerror="this.style.display='none'"></div>
                        <div class="doc-content-box">
                            <div class="doc-header"><h1 class="doc-title">${topic.title}</h1></div>
                            <div class="doc-body">${topic.content}</div>
                        </div>
                    </div>`;
            } else {
                html = `
                    <div class="doc-layout no-image">
                        <div class="doc-content-box" style="text-align:center; padding: 80px;">
                            <div class="doc-header"><h1 class="doc-title">${topic.title}</h1></div>
                            <div class="doc-body" style="text-align:left; max-width:800px; margin:0 auto;">${topic.content}</div>
                        </div>
                    </div>`;
            }
            const tabBtn = createNewTabElement(tabId, topic.title); tabBtn.classList.add('invisible-waiting'); document.getElementById('tabList').appendChild(tabBtn);
            const panel = document.createElement('div'); panel.className = 'view-panel'; panel.id = tabId; panel.innerHTML = html; document.getElementById('viewport').appendChild(panel);
            tabBtn.scrollIntoView({behavior: "auto", block: "nearest", inline: "end"}); updateFloatingBar();
            if (tileElement) { animateTileToTab(tileElement, tabBtn, () => { tabBtn.classList.remove('invisible-waiting'); if (!stayOnHome) switchTab(tabId); }); } else { tabBtn.classList.remove('invisible-waiting'); if (!stayOnHome) switchTab(tabId); }
        }

        /* --- COMMON --- */
        function handleSearchInput(e) { const keyword = e.target.value.toLowerCase().trim(); const canvas = document.getElementById('searchCanvas'); if (e.key === 'Enter') { if (keyword.length < 2) { canvas.classList.remove('active'); return; } performDeepSearch(keyword); return; } canvas.classList.remove('active'); }
        function performDeepSearch(keyword) { const canvas = document.getElementById('searchCanvas'); canvas.innerHTML = ''; let resultsFound = 0; const createSnippet = (text, query) => { const lowerText = text.toLowerCase(); const idx = lowerText.indexOf(query); if (idx === -1) return null; const start = Math.max(0, idx - 50); const end = Math.min(text.length, idx + query.length + 50); let snippet = text.substring(start, end); const regex = new RegExp(`(${query})`, 'gi'); return "..." + snippet.replace(regex, '<span class="highlight">$1</span>') + "..."; }; const renderResult = (title, snippet, onClickFunc) => { const div = document.createElement('div'); div.className = 'search-result-item'; div.innerHTML = `<div class="res-location">LOCATION: ${title}</div><div class="res-snippet">${snippet}</div>`; div.onclick = onClickFunc; canvas.appendChild(div); resultsFound++; }; topics.forEach(topic => { const plainText = topic.content.replace(/<[^>]*>/g, ' '); const snippet = createSnippet(plainText, keyword); if (snippet) { renderResult(topic.title, snippet, () => { openTopicTab(topic); canvas.classList.remove('active'); }); } }); importedFilesData.forEach(file => { const snippet = createSnippet(file.content, keyword); if (snippet) { renderResult(file.title, snippet, () => { openImportedTabContent(file.title, file.contentHTML); canvas.classList.remove('active'); }); } }); if (resultsFound === 0) canvas.innerHTML = '<div class="no-result">Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu.</div>'; canvas.classList.add('active'); }
        function openImportedTabContent(title, htmlContent) { const tabId = `import-${Date.now()}`; const btn = createNewTabElement(tabId, title); document.getElementById('tabList').appendChild(btn); const panel = document.createElement('div'); panel.className = 'view-panel'; panel.id = tabId; panel.innerHTML = `<div class="doc-layout no-image"><div class="doc-content-box"><div class="doc-header"><h1 class="doc-title">${title}</h1></div><div class="doc-body">${htmlContent}</div></div></div>`; document.getElementById('viewport').appendChild(panel); switchTab(tabId); }
        function updateFloatingBar() { const tabs = Array.from(document.querySelectorAll('.tab')); const bar = document.getElementById('floatingBar'); bar.innerHTML = ''; const btnA = document.createElement('div'); btnA.className = 'f-item f-action a-btn'; btnA.innerText = 'A'; btnA.onclick = triggerAllTabs; bar.appendChild(btnA); const total = tabs.length - 1; if (total > 0) { const act = tabs.findIndex(t => t.classList.contains('active')); const mkBtn = (i) => { const b=document.createElement('div'); b.className='f-item'; if(act===i)b.classList.add('current'); b.innerText=i; b.onclick=()=>tabs[i].click(); bar.appendChild(b); }; const mkDot = () => { const d=document.createElement('div'); d.className='f-dots'; d.innerText='...'; bar.appendChild(d); }; if (act === 0) { if (total <= 3) { for(let i=1;i<=total;i++) mkBtn(i); } else { mkBtn(1); mkBtn(2); mkDot(); mkBtn(total); } } else { mkBtn(1); if(act>2) mkDot(); if(act!==1 && act!==total) mkBtn(act); if(act<total-1) mkDot(); if(total>1) mkBtn(total); } } const btnDA = document.createElement('div'); btnDA.className = 'f-item f-action da-btn'; btnDA.innerText = 'DA'; btnDA.ondblclick = () => { if(confirm("X√°c nh·∫≠n x√≥a s·∫°ch d·ªØ li·ªáu?")) { closeAllTabs(); topics = []; renderGrid(); alert("ƒê√£ reset."); } }; btnDA.onclick = closeAllTabs; bar.appendChild(btnDA); }
        function triggerAllTabs() { document.getElementById('searchBox').value = ''; topics.forEach((topic, index) => { const tile = document.getElementById(`tile-${topic.id}`); if (tile) { setTimeout(() => { openTopicTab(topic, tile, true); }, index * 200); } }); }
        function closeAllTabs() { const tabs = document.querySelectorAll('.tab'); tabs.forEach(tab => { if (tab.dataset.target !== 'home-view') { document.getElementById(tab.dataset.target)?.remove(); tab.remove(); } }); switchTab('home-view'); }
        function animateTileToTab(tileElement, tabElement, onComplete) { const startRect = tileElement.getBoundingClientRect(); const endRect = tabElement.getBoundingClientRect(); const ghost = document.createElement('div'); ghost.className = 'morph-ghost'; ghost.innerHTML = tileElement.innerHTML; ghost.style.left = startRect.left + 'px'; ghost.style.top = startRect.top + 'px'; ghost.style.width = startRect.width + 'px'; ghost.style.height = startRect.height + 'px'; ghost.style.fontFamily = "'Space Grotesk', sans-serif"; ghost.style.fontWeight = "700"; ghost.style.textTransform = "uppercase"; ghost.style.color = "#fff"; ghost.style.fontSize = "1rem"; document.body.appendChild(ghost); requestAnimationFrame(() => { ghost.style.left = endRect.left + 'px'; ghost.style.top = endRect.top + 'px'; ghost.style.width = endRect.width + 'px'; ghost.style.height = endRect.height + 'px'; ghost.style.opacity = '0.5'; ghost.style.fontSize = "0.8rem"; }); setTimeout(() => { ghost.remove(); if (onComplete) onComplete(); }, 600); }
        function createNewTabElement(id, title) { const tabBtn = document.createElement('div'); tabBtn.className = 'tab'; tabBtn.dataset.target = id; tabBtn.innerHTML = `<span title="${title}">${title}</span><div class="tab-close" onclick="closeTab('${id}', event)">‚úï</div>`; tabBtn.onclick = () => switchTab(id); return tabBtn; }
        function switchTab(id) { document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); document.querySelectorAll('.view-panel').forEach(p => p.classList.remove('active')); const t = document.querySelector(`.tab[data-target="${id}"]`); const p = document.getElementById(id); if(t && p) { t.classList.add('active'); p.classList.add('active'); t.scrollIntoView({behavior:'smooth', inline:'center'}); updateFloatingBar(); } }
        function closeTab(id, e) { if(e) e.stopPropagation(); const t = document.querySelector(`.tab[data-target="${id}"]`); const p = document.getElementById(id); if(t.classList.contains('active')) switchTab('home-view'); t.remove(); p.remove(); updateFloatingBar(); }
        function handleGlobalKeys(e) { const activeTag = document.activeElement.tagName; if (activeTag === 'INPUT' || activeTag === 'TEXTAREA') return; const tabs = Array.from(document.querySelectorAll('.tab')); if (!tabs.length) return; const activeIndex = tabs.findIndex(t => t.classList.contains('active')); if (activeIndex === -1) return; if (e.key === 'ArrowRight') tabs[(activeIndex + 1) % tabs.length].click(); else if (e.key === 'ArrowLeft') tabs[(activeIndex - 1 + tabs.length) % tabs.length].click(); else if (e.key === 'Backspace') { const targetId = tabs[activeIndex].dataset.target; if (targetId !== 'home-view') closeTab(targetId, null); } }
        function initDraggableChat() { const widget = document.getElementById('draggableChat'); const btn = document.getElementById('chatBtn'); let isDragging = false; let startX, startY, initialLeft, initialTop; let hasMoved = false; const updateChatOrientation = () => { const chatWindow = document.getElementById('chatWindow'); if (!chatWindow) return; const rect = widget.getBoundingClientRect(); const winH = window.innerHeight; const winW = window.innerWidth; chatWindow.style.top = ''; chatWindow.style.bottom = ''; chatWindow.style.left = ''; chatWindow.style.right = ''; if (rect.top < winH / 2) { chatWindow.style.top = '80px'; chatWindow.style.bottom = 'auto'; chatWindow.style.transformOrigin = 'top right'; } else { chatWindow.style.bottom = '85px'; chatWindow.style.top = 'auto'; chatWindow.style.transformOrigin = 'bottom right'; } if (rect.left < winW / 2) { chatWindow.style.left = '0'; chatWindow.style.right = 'auto'; let currentOrigin = chatWindow.style.transformOrigin; chatWindow.style.transformOrigin = currentOrigin.replace('right', 'left'); } else { chatWindow.style.right = '0'; chatWindow.style.left = 'auto'; } }; const startDrag = (e) => { if (e.target.closest('.chat-window')) return; isDragging = true; hasMoved = false; const clientX = e.clientX || e.touches[0].clientX; const clientY = e.clientY || e.touches[0].clientY; startX = clientX; startY = clientY; const rect = widget.getBoundingClientRect(); initialLeft = rect.left; initialTop = rect.top; widget.style.transition = 'none'; if(e.type === 'touchstart') e.preventDefault(); }; const doDrag = (e) => { if (!isDragging) return; const clientX = e.clientX || e.touches[0].clientX; const clientY = e.clientY || e.touches[0].clientY; const dx = clientX - startX; const dy = clientY - startY; if (Math.abs(dx) > 5 || Math.abs(dy) > 5) hasMoved = true; widget.style.left = `${initialLeft + dx}px`; widget.style.top = `${initialTop + dy}px`; widget.style.bottom = 'auto'; widget.style.right = 'auto'; }; const stopDrag = () => { if (!isDragging) return; isDragging = false; const rect = widget.getBoundingClientRect(); const winWidth = window.innerWidth; const winHeight = window.innerHeight; widget.style.transition = 'all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1)'; const distBottom = winHeight - (rect.top + rect.height); if (distBottom < 100) widget.style.top = `${winHeight - rect.height - 20}px`; else { if (rect.left < (winWidth - (rect.left + rect.width))) widget.style.left = '20px'; else widget.style.left = `${winWidth - rect.width - 20}px`; } setTimeout(updateChatOrientation, 400); if (!hasMoved) { toggleChat(); updateChatOrientation(); } }; btn.addEventListener('mousedown', startDrag); document.addEventListener('mousemove', doDrag); document.addEventListener('mouseup', stopDrag); btn.addEventListener('touchstart', startDrag, {passive: false}); document.addEventListener('touchmove', doDrag, {passive: false}); document.addEventListener('touchend', stopDrag); }
        function toggleChat() { const widget = document.getElementById('draggableChat'); if (widget.style.cursor === 'grabbing') return; document.getElementById('chatWindow').classList.toggle('open'); }
        function initChat() { const body = document.getElementById('chatBody'); const indicator = document.getElementById('typingIndicator'); while(body.firstChild && body.firstChild !== indicator) body.removeChild(body.firstChild); addBotMessage("Ch√†o b·∫°n! T√¥i l√† Huy's Assistant. T√¥i c√≥ th·ªÉ h·ªó tr·ª£ th√¥ng tin g√¨ cho b·∫°n?"); const suggestions = document.createElement('div'); suggestions.className = 'suggestions'; const keys = ["Li√™n h·ªá", "Facebook", "L√£i su·∫•t", "Th·∫ª t√≠n d·ª•ng", "Email"]; keys.forEach(k => { const chip = document.createElement('div'); chip.className = 'chip'; chip.innerText = k; chip.onclick = () => { document.getElementById('chatInput').value = k; sendMsg(); }; suggestions.appendChild(chip); }); body.insertBefore(suggestions, indicator); }
        function sendMsg() { const inp = document.getElementById('chatInput'); const txt = inp.value.trim(); if(!txt) return; addUserMessage(txt); inp.value = ''; processBotReply(txt); }
        function addUserMessage(text) { const body = document.getElementById('chatBody'); const indicator = document.getElementById('typingIndicator'); const div = document.createElement('div'); div.className = 'msg user'; div.innerText = text; body.insertBefore(div, indicator); body.scrollTop = body.scrollHeight; }
        function addBotMessage(text) { const body = document.getElementById('chatBody'); const indicator = document.getElementById('typingIndicator'); const div = document.createElement('div'); div.className = 'msg bot'; div.innerHTML = text; body.insertBefore(div, indicator); body.scrollTop = body.scrollHeight; }
        const botBrain = { "xin ch√†o": "Ch√†o b·∫°n! Ch√†o m·ª´ng ƒë·∫øn v·ªõi Huy's Nexus.", "hi": "Hi! R·∫•t vui ƒë∆∞·ª£c g·∫∑p b·∫°n.", "huy": "Huy l√† nh√† ph√°t tri·ªÉn ch√≠nh.", "nexus": "Huy's Nexus l√† m·ªôt h·ªá sinh th√°i s·ªë.", "l√£i su·∫•t": "L√£i su·∫•t ti·∫øt ki·ªám: 6.8%/nƒÉm.", "th·∫ª t√≠n d·ª•ng": "Th·∫ª Classic, Gold, Platinum.", "vay": "Vay ti√™u d√πng 0.8%/th√°ng.", "ekyc": "eKYC m·ªü t√†i kho·∫£n 2 ph√∫t.", "b·∫£o m·∫≠t": "M√£ h√≥a 256-bit.", "s·ªë d∆∞": "Tra c·ª©u tr√™n App.", "chuy·ªÉn ti·ªÅn": "Mi·ªÖn ph√≠ 24/7.", "ph√≠": "Zero Fee.", "qu√™n m·∫≠t kh·∫©u": "L·∫•y l·∫°i qua SMS OTP.", "t·ª∑ gi√°": "USD/VND = 24,550.", "ti·∫øt ki·ªám": "G·ª≠i online +0.2%.", "gian l·∫≠n": "Kh√≥a th·∫ª ngay tr√™n App.", "ƒë·∫ßu t∆∞": "Robo-Advisor ƒë·∫ßu t∆∞ t·ª´ 50k.", "li√™n h·ªá": "Hotline: 1900-6767-6969. Email: hulareous@gmail.com", "hotline": "Hotline: 1900-6767-6969.", "sƒët": "SƒêT: 1900-6767-6969.", "g·ªçi": "G·ªçi 1900-6767-6969.", "email": "Email: hulareous@gmail.com.", "gmail": "Email: hulareous@gmail.com.", "mail": "Email: hulareous@gmail.com.", "ƒë·ªãa ch·ªâ": "VP: TP.HCM.", "facebook": "FB: <a href='https://www.facebook.com/hulareous' target='_blank'>Huy's Facebook</a>", "fb": "FB: <a href='https://www.facebook.com/hulareous' target='_blank'>Huy's Facebook</a>", "mxh": "FB: <a href='https://www.facebook.com/hulareous' target='_blank'>Huy's Facebook</a>", "tuy·ªÉn d·ª•ng": "Xem t·∫°i FB.", "c√° nh√¢n": "Xem t·∫°i FB." };
        const fallbackResponse = "Xin l·ªói, t√¥i ch∆∞a hi·ªÉu √Ω b·∫°n. Th·ª≠: Facebook, Email, Hotline...";
        function processBotReply(userText) { const indicator = document.getElementById('typingIndicator'); indicator.style.display = 'flex'; const body = document.getElementById('chatBody'); body.scrollTop = body.scrollHeight; const lowerText = userText.toLowerCase(); const weakKeys = ['huy', 'nexus', 'xin ch√†o', 'hi', 'ch√†o', 'b·∫°n ∆°i', 'ad', 'admin']; let foundKeywords = []; for (let key in botBrain) { const idx = lowerText.indexOf(key); if (idx !== -1) foundKeywords.push({ key: key, index: idx, isWeak: weakKeys.includes(key), content: botBrain[key] }); } foundKeywords.sort((a, b) => a.index - b.index); const hasStrongKey = foundKeywords.some(item => !item.isWeak); let finalKeywords = hasStrongKey ? foundKeywords.filter(item => !item.isWeak) : foundKeywords; let uniqueReplies = []; let seenContent = new Set(); finalKeywords.forEach(item => { if (!seenContent.has(item.content)) { uniqueReplies.push(item.content); seenContent.add(item.content); } }); setTimeout(() => { indicator.style.display = 'none'; if (uniqueReplies.length > 0) uniqueReplies.forEach((reply, index) => { setTimeout(() => { addBotMessage(reply); }, index * 600); }); else addBotMessage(fallbackResponse); }, 1000); }

        init();
    </script>
</body>
</html>
